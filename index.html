<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Geri SayÄ±m</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at bottom, #020111, #000000 70%);
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      text-align: center;
      overflow: hidden;
    }

    canvas#stars { position: fixed; inset: 0; z-index: 0; }

    .box {
      position: relative;
      z-index: 2;
      background: rgba(255,255,255,0.08);
      padding: 40px 50px;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      max-width: 420px;
      width: 90%;
    }

    h1 { font-size: 1.8rem; margin: 0 0 16px; }
    #countdown { font-size: 2.4rem; font-weight: 700; margin: 18px 0 0; }

    input, button {
      padding: 12px 14px;
      border-radius: 12px;
      border: none;
      font-size: 1rem;
      margin-top: 10px;
      width: 100%;
      box-sizing: border-box;
    }

    button { cursor: pointer; background: #00c6ff; color: #000; font-weight: 700; }
    button:hover { opacity: 0.95; }

    .hidden { display: none; }

    /* AÅK MEKTUBU */
    #letter {
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.6);
      z-index: 3;
      animation: fadeIn 1.2s ease forwards;
      padding: 18px;
      box-sizing: border-box;
    }

    #letter .paper {
      background: #fff;
      color: #000;
      padding: 40px;
      border-radius: 16px;
      max-width: 520px;
      width: 100%;
      font-size: 1.1rem;
      line-height: 1.6;
      animation: floatUp 1.2s ease forwards;
      position: relative;
      overflow: hidden;
      text-align: left;
    }

    #typedText {
      white-space: pre-wrap; /* \n satÄ±rlarÄ±nÄ± gÃ¶ster */
    }

    #typedText::after { content: '|'; animation: blink 1s infinite; }

    @keyframes blink { 50% { opacity: 0; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes floatUp { from { transform: translateY(34px); } to { transform: translateY(0); } }

    /* KALPLER */
    .heart {
      position: absolute;
      bottom: -22px;
      animation: fly 4s linear forwards;
      opacity: 0.85;
      user-select: none;
      pointer-events: none;
    }

    @keyframes fly {
      to { transform: translateY(-120vh) translateX(40px); opacity: 0; }
    }

    /* FÄ°NAL */
    #finalScreen {
      position: fixed;
      inset: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 3.2rem;
      font-weight: 800;
      z-index: 5;
      animation: fadeIn 1.8s forwards;
      padding: 24px;
      box-sizing: border-box;
      text-align: center;
    }

    /* Autoplay engellenirse gÃ¶rÃ¼nen buton */
    #musicBtn {
      margin-top: 12px;
      background: #fff;
      color: #000;
    }

    .hint { opacity: 0.85; font-size: 0.95rem; margin-top: 10px; }
  </style>
</head>
<body>
  <canvas id="stars"></canvas>

  <div class="box">
    <h1>Ã–nce kÃ¼Ã§Ã¼k bir kontrol ğŸ‘€</h1>

    <div id="passwordBox">
      <input type="password" id="passwordInput" placeholder="Åifreyi gir" />
      <button id="enterBtn" type="button">Devam et</button>
      <div class="hint">DoÄŸru ÅŸifre + doÄŸru zaman = sÃ¼rpriz</div>
    </div>

    <div id="countdownBox" class="hidden">
      <h1>HazÄ±r olâ€¦ â³</h1>
      <div id="countdown">00:00:00</div>
      <button id="musicBtn" class="hidden" type="button">MÃ¼ziÄŸi BaÅŸlat ğŸµ</button>
      <div class="hint" id="musicHint" style="display:none;">TarayÄ±cÄ± otomatik mÃ¼ziÄŸi engelledi â€” butona dokun ğŸ˜…</div>
    </div>
  </div>

  <!-- Telif nedeniyle MP3 dosyasÄ±nÄ± repo'ya sen koymalÄ±sÄ±n -->
  <audio id="bgMusic" loop preload="auto">
    <source src="lady-gaga-paparazzi.mp3" type="audio/mpeg" />
  </audio>

  <script>
    /* ================= AYARLAR ================= */
    const correctPassword = "SeloÅŸ123.";
    const targetDate = new Date("2025-12-17T21:17:00").getTime();

    const text = `CanÄ±mÄ±n iÃ§i,\n\nBu yÄ±l benim hayatÄ±ma giren en deÄŸerli insansÄ±n. Ne kadar komik ocak ayÄ±nda senden bihaberken ÅŸu anda sensiz bir gelecek hayal edemiyorum. 2026 yÄ±lÄ± bizim yÄ±lÄ±mÄ±z olacak, tÃ¼m hedeflerimize, hayallerimize birlikte ulaÅŸtÄ±ÄŸÄ±mÄ±z, birbirimizi hep en ileriye taÅŸÄ±dÄ±ÄŸÄ±mÄ±z bir yÄ±l olsun. Bu yÄ±l Noel babadan bir dileÄŸim yok Ã§Ã¼nkÃ¼ zaten en bÃ¼yÃ¼k dileÄŸim artÄ±k hayatÄ±mda.\n\nSeni Ã§oooooooooooooooook seviyorum AÅK TANEM :)))`;

    const finalSentence = "Ä°YÄ° KÄ° VARSIN AÅK TANEM :)))";

    /* ================= ELEMENTLER ================= */
    const passwordBox = document.getElementById("passwordBox");
    const countdownBox = document.getElementById("countdownBox");
    const passwordInput = document.getElementById("passwordInput");
    const enterBtn = document.getElementById("enterBtn");
    const countdownEl = document.getElementById("countdown");
    const musicBtn = document.getElementById("musicBtn");
    const musicHint = document.getElementById("musicHint");

    const audio = document.getElementById("bgMusic");
    let audioUnlocked = false;

    /* ================= SES (AUTOPLAY) ================= */
    function unlockAudio() {
      if (audioUnlocked) return;
      // KullanÄ±cÄ± tÄ±klamasÄ± anÄ±nda play/pause => sonraki play denemeleri daha stabil olur.
      audio.muted = true;
      const p = audio.play();
      if (p && typeof p.then === 'function') {
        p.then(() => {
          audio.pause();
          audio.currentTime = 0;
          audio.muted = false;
          audioUnlocked = true;
        }).catch(() => {
          audio.muted = false;
        });
      } else {
        // Eski tarayÄ±cÄ± fallback
        try { audio.pause(); } catch (_) {}
        audio.currentTime = 0;
        audio.muted = false;
        audioUnlocked = true;
      }
    }

    async function playMusic(fromStart = true) {
      if (fromStart) audio.currentTime = 0;
      try {
        await audio.play();
        musicBtn.classList.add('hidden');
        musicHint.style.display = 'none';
        return true;
      } catch (e) {
        // Autoplay bloklandÄ±
        musicBtn.classList.remove('hidden');
        musicHint.style.display = 'block';
        return false;
      }
    }

    musicBtn.addEventListener('click', async () => {
      unlockAudio();
      await playMusic(true);
      musicBtn.classList.add('hidden');
      musicHint.style.display = 'none';
    });

    /* ================= ÅÄ°FRE / GÄ°RÄ°Å ================= */
    function onEnter() {
      const input = passwordInput.value;
      if (input !== correctPassword) {
        alert("Åifre yanlÄ±ÅŸ ğŸ˜…");
        return;
      }

      // KullanÄ±cÄ± etkileÅŸimi var => sesi unlock et
      unlockAudio();

      passwordBox.classList.add("hidden");
      countdownBox.classList.remove("hidden");

      // EÄŸer tarih geÃ§tiyse (siteye gÃ¼nler sonra bile girse) => hemen final + mÃ¼zik
      if (Date.now() >= targetDate) {
        startFinalSequence(true);
      }
    }

    enterBtn.addEventListener('click', onEnter);
    passwordInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') onEnter();
    });

    /* ================= GERÄ° SAYIM ================= */
    setInterval(() => {
      const now = Date.now();
      const distance = targetDate - now;

      if (distance <= 0) {
        countdownEl.textContent = `00sa 00dk 00sn`;
        // KullanÄ±cÄ± zaten giriÅŸ yaptÄ±ysa final akÄ±ÅŸÄ±nÄ± baÅŸlatmayÄ± dener
        startFinalSequence(false);
        return;
      }

      const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const s = Math.floor((distance % (1000 * 60)) / 1000);
      countdownEl.textContent = `${h.toString().padStart(2,'0')}sa ${m.toString().padStart(2,'0')}dk ${s.toString().padStart(2,'0')}sn`;
    }, 1000);

    /* ================= YILDIZLAR ================= */
    const canvas = document.getElementById('stars');
    const ctx = canvas.getContext('2d');

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resize);
    resize();

    const stars = Array.from({ length: 150 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 1.5,
      tw: 0.02 + Math.random() * 0.03
    }));

    (function drawStars(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (const s of stars) {
        s.r += (Math.random() - 0.5) * s.tw;
        if (s.r < 0.2) s.r = 0.2;
        if (s.r > 1.8) s.r = 1.8;
        ctx.beginPath();
        ctx.fillStyle = 'white';
        ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        ctx.fill();
      }
      requestAnimationFrame(drawStars);
    })();

    /* ================= FÄ°NAL AKIÅ ================= */
    let shown = false;
    let heartsIntervalId = null;

    function startFinalSequence(fromUserClick) {
      if (shown) return;

      // kullanÄ±cÄ± giriÅŸ yapmadan tetikleme
      const isLoggedIn = countdownBox && !countdownBox.classList.contains('hidden');
      if (!isLoggedIn) return;

      if (Date.now() < targetDate) return;

      shown = true;

      // MÃ¼zik: her giriÅŸte (sayfa yenilense de) BAÅTAN Ã§al
      // EÄŸer bu fonksiyon tÄ±klamadan gelmediyse autoplay bloklanabilir => buton gÃ¶sterilecek.
      playMusic(true);

      document.body.insertAdjacentHTML('beforeend', `
        <div id="letter">
          <div class="paper">
            <h2>Sevgilim,</h2>
            <p id="typedText"></p>
          </div>
        </div>`);

      const typedEl = document.getElementById('typedText');
      let i = 0;

      const typerId = setInterval(() => {
        if (!typedEl) { clearInterval(typerId); return; }
        typedEl.textContent += text.charAt(i);
        i++;
        if (i >= text.length) {
          clearInterval(typerId);
          setTimeout(showFinal, 1500);
        }
      }, 85);

      // Kalpler: son satÄ±ra yaklaÅŸÄ±nca hÄ±zlanÄ±r
      const baseMs = 150;
      const boostedMs = 90;
      const boostAt = Math.max(0, text.length - 35);

      let currentMs = baseMs;

      function emitHeart() {
        const paper = document.querySelector('#letter .paper');
        if (!paper) return;
        const h = document.createElement('div');
        h.className = 'heart';
        h.textContent = 'â¤ï¸';
        h.style.left = Math.random() * 100 + '%';
        h.style.fontSize = (18 + Math.random() * 22) + 'px';
        paper.appendChild(h);
        setTimeout(() => h.remove(), 4000);
      }

      function setHeartSpeed(ms) {
        if (heartsIntervalId) clearInterval(heartsIntervalId);
        heartsIntervalId = setInterval(emitHeart, ms);
        currentMs = ms;
      }

      setHeartSpeed(baseMs);

      // YazÄ± ilerledikÃ§e hÄ±z gÃ¼ncelle
      const heartControl = setInterval(() => {
        const shouldBoost = i >= boostAt;
        const desired = shouldBoost ? boostedMs : baseMs;
        if (desired !== currentMs) setHeartSpeed(desired);
        if (i >= text.length) {
          clearInterval(heartControl);
        }
      }, 200);
    }

    // Geri sayÄ±m bittikten sonra, kullanÄ±cÄ± giriÅŸ yaptÄ±ysa baÅŸlatmayÄ± dener
    setInterval(() => startFinalSequence(false), 1000);

    function showFinal() {
      document.body.insertAdjacentHTML('beforeend', `<div id="finalScreen">${finalSentence}</div>`);
    }

    /* ================= MINI SELF-CHECK (TEST) ================= */
    // Konsolda hÄ±zlÄ± kontrol iÃ§in: sayfa aÃ§Ä±lÄ±nca temel fonksiyonlar var mÄ±?
    console.assert(typeof onEnter === 'function', 'onEnter tanÄ±mlÄ± deÄŸil');
    console.assert(typeof startFinalSequence === 'function', 'startFinalSequence tanÄ±mlÄ± deÄŸil');
    console.assert(typeof unlockAudio === 'function', 'unlockAudio tanÄ±mlÄ± deÄŸil');
  </script>
</body>
</html>
